-- Insert a new product family for testing
INSERT INTO Product_Family (Family_ID, Family_Description) VALUES (999, 'Test Family for All Machines');


INSERT INTO Product (Product_ID, Product_Name, Product_Description, Factory_Plant_ID, Family_ID)
VALUES ('ALL_WS_PRODUCT', 'Universal Product', 'Product using all workstations', 1, 999);


-- Mapping all Manufacturing Operations for Universal Product Family in BOO
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5647, 1);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5649, 2);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5651, 3);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5653, 4);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5655, 5);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5657, 6);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5659, 7);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5661, 8);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5663, 9);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5665, 10);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5667, 11);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5669, 12);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5671, 13);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5681, 14);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5682, 15);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5683, 16);
INSERT INTO BOO (Product_Family_ID, Manufacturing_Operation_ID, Operation_Order) VALUES (999, 5688, 17);

-- Linking all Manufacturing Operations for Universal Product Family to each Workstation Type
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2001, 'Universal Operation', 5647, 'A4578');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2002, 'Universal Operation', 5649, 'A4588');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2003, 'Universal Operation', 5651, 'A4598');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2004, 'Universal Operation', 5653, 'C5637');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2005, 'Universal Operation', 5655, 'S3271');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2006, 'Universal Operation', 5657, 'K3675');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2007, 'Universal Operation', 5659, 'K3676');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2008, 'Universal Operation', 5661, 'D9123');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2009, 'Universal Operation', 5663, 'Q5478');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2010, 'Universal Operation', 5665, 'Q3547');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2011, 'Universal Operation', 5667, 'T3452');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2012, 'Universal Operation', 5669, 'G9273');
INSERT INTO Type_Industry (Type_Industry_ID, Type_Industry, Manufacturing_Operation_ID, Workstation_Type_ID) VALUES (2013, 'Universal Operation', 5671, 'G9274');


WITH Families_Using_All_Workstations AS (
    SELECT boo.Product_Family_ID
    FROM BOO boo
    JOIN Type_Industry ti ON boo.Manufacturing_Operation_ID = ti.Manufacturing_Operation_ID
    GROUP BY boo.Product_Family_ID
    HAVING COUNT(DISTINCT ti.Workstation_Type_ID) = (
        SELECT COUNT(DISTINCT Workstation_Type_ID) FROM Workstation_Type
    )
)

-- Step 2: Select Products from those Families
SELECT p.Product_ID, p.Product_Name
FROM Product p
WHERE p.Family_ID IN (SELECT Product_Family_ID FROM Families_Using_All_Workstations);